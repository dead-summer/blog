import{a,c as r,b as e,d as n,r as o,o as t}from"./app-CAzY0Upz.js";const s={};function d(c,l){const i=o("Mermaid");return t(),r("div",null,[l[0]||(l[0]=e('<h2 id="查询执行流程" tabindex="-1"><a class="header-anchor" href="#查询执行流程"><span>查询执行流程</span></a></h2><p>当 MySQL 数据库接收到一条 SQL 查询语句时，会依次经过以下核心组件和阶段：</p><h3 id="_1-连接器-connector" tabindex="-1"><a class="header-anchor" href="#_1-连接器-connector"><span>1. 连接器（Connector）</span></a></h3><ul><li><strong>功能</strong>： <ul><li>建立与客户端的网络连接（支持 TCP/IP、Socket 等协议）。</li><li>验证用户身份及权限（基于用户名、密码和主机信息）。</li><li>管理连接池（包括长连接/短连接的维护和超时控制）。</li></ul></li><li><strong>关键点</strong>： <ul><li>连接建立后，权限验证仅依赖初始读取的权限快照。</li><li>长连接需定期重置避免内存泄漏（通过 <code>mysql_reset_connection()</code>）。</li></ul></li></ul><h3 id="_2-查询缓存-query-cache" tabindex="-1"><a class="header-anchor" href="#_2-查询缓存-query-cache"><span>2. 查询缓存（Query Cache）</span></a></h3><ul><li><strong>历史行为</strong>： <ul><li>对完全匹配的 SQL 语句，尝试返回缓存结果（Key-Value 结构，Key 为 SQL 原文）。</li><li>若表数据变更，关联的所有缓存自动失效。</li></ul></li><li><strong>移除原因（MySQL 8.0 起默认禁用并彻底移除该模块）</strong>： <ul><li>缓存命中率低（OLTP 场景更新频繁）。</li><li>全局锁竞争影响并发性能。</li></ul></li></ul><h3 id="_3-解析器-parser" tabindex="-1"><a class="header-anchor" href="#_3-解析器-parser"><span>3. 解析器（Parser）</span></a></h3><ul><li><strong>处理流程</strong>： <ul><li><strong>词法分析</strong>：拆分 SQL 语句为原子 Token（如识别 <code>SELECT</code>、<code>FROM</code> 等关键字）。</li><li><strong>语法分析</strong>：基于语法规则构建抽象语法树（AST）。</li></ul></li><li><strong>错误处理</strong>： <ul><li>语法错误在此阶段抛出（如缺少引号、错误关键字等）。</li></ul></li></ul><h3 id="_4-优化器-optimizer" tabindex="-1"><a class="header-anchor" href="#_4-优化器-optimizer"><span>4. 优化器（Optimizer）</span></a></h3><ul><li><strong>核心作用</strong>： <ul><li>选择最优执行计划（如索引选择、JOIN 顺序、子查询优化）。</li><li>基于成本模型（Cost Model）评估不同方案。</li></ul></li><li><strong>典型决策</strong>： <ul><li>全表扫描 vs 索引扫描。</li><li>嵌套循环连接（Nested-Loop Join） vs 哈希连接（Hash Join）。</li></ul></li></ul><h3 id="_5-执行器-executor" tabindex="-1"><a class="header-anchor" href="#_5-执行器-executor"><span>5. 执行器（Executor）</span></a></h3><ul><li><strong>执行逻辑</strong>： <ul><li>调用存储引擎接口，按优化器生成的执行计划逐步获取数据。</li><li>执行前二次验证用户对目标表的操作权限。</li></ul></li><li><strong>交互流程</strong>： <ul><li>通过 <code>Handler API</code> 与存储引擎（如 InnoDB）交互。</li><li>逐行处理数据并聚合结果集（如排序、分组操作）。</li></ul></li></ul><h3 id="_6-结果返回-result-return" tabindex="-1"><a class="header-anchor" href="#_6-结果返回-result-return"><span>6. 结果返回（Result Return）</span></a></h3><ul><li><strong>输出阶段</strong>： <ul><li>将最终结果集通过连接器返回客户端。</li><li>结果集可能分批次传输（受 <code>max_allowed_packet</code> 限制）。</li></ul></li><li><strong>资源清理</strong>： <ul><li>临时表释放、线程状态重置等收尾操作。</li></ul></li></ul><h3 id="流程总结" tabindex="-1"><a class="header-anchor" href="#流程总结"><span>流程总结</span></a></h3>',15)),n(i,{code:"eJxNj8tKw1AQhvd9inmBiktXgr260IXo7pCFK12KO/G40IJECDU1qTREU1stCUob8UIWDfRlnDmTtzA9gbSzm+H7v5k5OT8+O4WjRgXy2hE4G5OZqI8Y73v8m8DhwR7QcMLx2IBqdRtqghcBdSfoRYaO1JZjSc+dzLOzd4vjawn1yyKiUgengyvN1TW3f7EUbm1sAiZfKpxn3puEhlD+T+7khYt+oOYOBU+FXIegKTh8pcAudza1S7lDMm2Op/Tdp5eehJb4SwdoPZZca42ju5BHFs9GaD5IaIuiL9G2Rvmzo9wovxlvIkz75HQl7OYfr+7K/Fuj8g82tJsk"}),l[1]||(l[1]=e('<h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><h3 id="执行一条-sql-查询语句-期间发生了什么" tabindex="-1"><a class="header-anchor" href="#执行一条-sql-查询语句-期间发生了什么"><span>执行一条 SQL 查询语句，期间发生了什么？</span></a></h3><ol><li><strong>连接器</strong>：建立连接，管理连接、校验用户身份。</li><li><strong>查询缓存</strong>（MySQL 8.0 已删除该模块）：查询语句如果命中查询缓存则直接返回，否则继续往下执行。</li><li><strong>解析 SQL</strong>：通过解析器对 SQL 查询语句进行词法分析、语法分析，以构建语法树，方便后续模块读取表名、字段、语句类型。</li><li><strong>执行 SQL</strong>：执行 SQL 共有三个阶段： <ul><li><strong>预处理阶段</strong>：检查表或字段是否存在，并将 <code>select *</code> 中的 <code>*</code> 符号扩展为表上的所有列。</li><li><strong>优化阶段</strong>：基于查询成本的考虑， 选择查询成本最小的执行计划。</li><li><strong>执行阶段</strong>：根据执行计划执行 SQL 查询语句，从存储引擎读取记录，返回给客户端。</li></ul></li></ol>',3))])}const u=a(s,[["render",d]]),g=JSON.parse('{"path":"/notes/interview/hl1gdxng/","title":"查询语句执行过程","lang":"zh-CN","frontmatter":{"title":"查询语句执行过程","createTime":"2025/08/29 17:19:29","permalink":"/notes/interview/hl1gdxng/"},"readingTime":{"minutes":2.86,"words":859},"git":{"createdTime":1756719850000,"updatedTime":1757065358000,"contributors":[{"name":"dead_summer","username":"","email":"2941325451@qq.com","commits":3,"avatar":"https://gravatar.com/avatar/d7f172441d823f01ad688f425860dbe76a31ea11c9936176bbd8c14670a619f8?d=retro"}]},"filePathRelative":"notes/八股文自救指南/MySQL/查询语句执行过程.md","headers":[]}');export{u as comp,g as data};
