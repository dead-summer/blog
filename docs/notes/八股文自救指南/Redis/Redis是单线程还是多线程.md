---
title: Redis是单线程还是多线程
createTime: 2025/09/05 16:55:14
permalink: /notes/interview/mbznp3uo/
---
## Redis 是单线程还是多线程？

关于 Redis 的线程模型，需要从不同维度进行分析：

1. **核心业务部分（命令处理）**：
    * **单线程**：Redis 的核心业务，即命令处理（数据读写操作），在绝大多数版本中仍是单线程模型。这意味着所有客户端的命令请求在执行阶段都是串行处理的，避免了多线程带来的锁、上下文切换等开销，保证了操作的原子性和数据一致性。

2. **整个 Redis 服务**：
    * **多线程**：如果考察整个 Redis 服务，包括核心业务外的其他功能，Redis 是多线程的。为了提高性能和处理效率，Redis 在不同版本中逐步引入了多线程来处理一些耗时操作。

## Redis 多线程演进

Redis 在版本迭代过程中，在以下两个关键时间节点引入了多线程支持：

1. **Redis 4.0**：
    * **引入多线程异步处理耗时任务**：Redis 4.0 引入了多线程来异步处理一些耗时较长的后台任务，以避免阻塞主线程。
    * **典型应用场景**：
        * **异步删除（`UNLINK` 命令）**：当需要删除一个占用大量内存的“大 Key”（BigKey）时，直接使用 `DEL` 命令可能会导致主线程长时间阻塞。`UNLINK` 命令会将 Key 的实际删除操作交给后台线程异步执行，主线程可以立即返回，提高响应速度。
        * **持久化操作**：在持久化机制中，例如 `BGSAVE`（后台保存 RDB 文件）和 `BGREWRITEAOF`（后台重写 AOF 文件），这些操作本身就由子进程（或后台线程）执行，以避免阻塞主线程。
    * **网络模型**：在 Redis 4.0 中，核心网络模型依然是单线程的，但其底层采用了 **I/O 多路复用**（如 `epoll`、`select` 等）机制，使得单线程在单机模式下也能达到每秒数万的并发处理能力，性能表现优异。

2. **Redis 6.0**：
    * **引入多线程处理网络 I/O**：随着硬件技术的发展，多核 CPU 服务器变得普及。传统的单线程网络模型无法充分利用多核 CPU 的性能。为了进一步提升 Redis 的吞吐量和并发处理能力，Redis 6.0 在核心网络模型中引入了多线程来处理网络 I/O。
    * **具体实现**：
        *   Redis 6.0 引入了多线程来**处理网络数据的读写和解析**，将这部分任务并行化。
        * **核心命令执行部分依然保持单线程**，确保了数据操作的简单性和无锁化。

