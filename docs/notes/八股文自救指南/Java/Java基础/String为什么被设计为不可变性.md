---
title: String为什么被设计为不可变性
createTime: 2025/09/04 16:42:13
permalink: /notes/interview/8h78gt34/
---
`String` 类被设计为不可变性，主要基于以下几个核心考量：内存与性能、安全性以及线程安全。

## 1. 内存与性能

字符串是 Java 中使用最频繁的数据结构之一。为了优化内存使用和提高性能，Java 引入了字符串常量池（String Pool）机制。

* **字符串常量池**：JVM 在堆内存中开辟了一块特殊的区域来存储字符串字面量。当创建字符串时，如果字符串常量池中已经存在相同内容的字符串，则直接返回该字符串的引用，而不是创建新的对象。
* **内存节省**：通过共享字符串对象，可以显著减少堆内存的占用。例如：
    ```java
    String s1 = "abcd";
    String s2 = "abcd";
    // s1 和 s2 将指向字符串常量池中同一个 "abcd" 对象
    ```
* **性能提升**：减少对象的创建频率，从而降低垃圾回收的压力，提升程序运行效率。

**不可变性是实现字符串常量池的关键**。如果 `String` 对象是可变的，当 `s1` 的内容被修改时，`s2` 的内容也会被动改变，这会违背共享对象的初衷，导致不可预期的行为。不可变性确保了共享字符串的引用是安全的，因为其内容永远不会改变。

## 2. 安全性

字符串在 Java 应用程序中广泛用于存储敏感信息，例如：

* 用户名和密码
* 数据库连接 URL
* 文件路径
* 网络连接参数
* 类加载路径

`String` 的不可变性对于提升整个应用程序的安全性至关重要：

* **信任度**：当一个字符串被传递给不同的方法或组件时，如果它是不可变的，那么可以确信其内容在传递过程中不会被恶意或意外地修改。
* **防止篡改**：例如，如果一个方法接收一个表示文件路径的 `String` 参数，如果该 `String` 是可变的，那么在方法内部修改这个路径字符串，可能会导致外部调用者获取到错误的路径，甚至引发安全漏洞。不可变性防止了这种潜在的篡改。

## 3. 线程安全

不可变对象天生就是线程安全的，因为它们的状态在创建后无法被修改。

* **共享安全**：当多个线程同时访问同一个 `String` 对象时，由于其内容不可变，因此不会出现数据竞争的问题，也无需额外的同步机制来保护其状态。
* **并发编程优势**：在多线程环境中，不可变对象可以安全地在线程之间共享和传递，简化了并发编程的复杂性，减少了死锁和活锁的风险。

如果 `String` 是可变的，那么在多线程环境下，一个线程对 `String` 对象的修改可能会立刻影响到其他正在使用该 `String` 的线程，导致不可预测的结果，需要复杂的同步机制来保证数据一致性。不可变性避免了这种复杂性。