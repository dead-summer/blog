---
title: 3-4.数据层测试回滚
createTime: 2025/06/25 12:20:17
permalink: /notes/HMSpringBoot/37ge49lq/
---
在软件开发过程中，测试是至关重要的一个环节，尤其是在打包发布之前。尽管我们的测试程序能够对表现层、业务层和数据层接口进行有效的功能测试，但在测试过程中，如果测试用例涉及到事务提交，可能会对数据库产生不必要的影响，产生垃圾数据。为了解决这个问题，Spring Boot 提供了简洁的解决方案，即使用 `@Transactional` 注解来阻止测试用例提交事务。

当 `@Transactional` 注解与 `@SpringBootTest` 注解同时存在时，Spring Boot 会将该程序识别为测试程序，从而避免提交事务。这意味着，在测试过程中对数据库所做的更改，在测试结束后会自动回滚，不会对实际数据库产生影响。

以下是一个示例代码，展示了如何使用 `@Transactional` 注解来阻止测试用例提交事务：

```JAVA
@SpringBootTest
@Transactional
@Rollback(true)
public class DaoTest {
    @Autowired
    private BookService bookService;

    @Test
    void testSave(){
        Book book = new Book();
        book.setName("springboot3");
        book.setType("springboot3");
        book.setDescription("springboot3");

        bookService.save(book);
    }
}
```

在上述代码中，`@Transactional` 注解确保了 `testSave` 方法中的 `bookService.save(book)` 操作不会实际提交到数据库。

如果开发者确实需要在测试中提交事务，可以使用 `@Rollback` 注解，并将其 `rollback` 属性设置为 `false`。例如：

```JAVA
@SpringBootTest
@Transactional
@Rollback(false)
public class DaoTest {
    // ...
}
```

在这种情况下，`testSave` 方法中的事务将会被提交，对数据库的更改会生效。
