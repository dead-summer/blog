---
title: 3-2.整合 MyBatis
createTime: 2025/07/15 23:02:20
permalink: /notes/HMSpringBoot/bzsh0owv/
---
MyBatis 是一款常用的持久层框架，在 Spring Boot 中整合 MyBatis 可以极大地简化数据库操作。下面将对比原始 Spring 整合 MyBatis 和 Spring Boot 整合 MyBatis 的方式，并着重介绍 Spring Boot 的整合步骤和注意事项。

## 1. 原始 Spring 整合 MyBatis

在传统的 Spring 项目中整合 MyBatis，需要进行以下步骤：

### **步骤 1：导入依赖坐标**

需要导入 MyBatis、Spring 整合 MyBatis 的专用坐标 `mybatis-spring`、Spring JDBC 坐标以及数据库驱动坐标。如果使用 Druid 数据源，还需要导入 Druid 的坐标。

```xml
<dependencies>
	<dependency>
		<groupId>com.alibaba</groupId>
		<artifactId>druid</artifactId>
		<version>1.1.16</version>
	</dependency>
	<dependency>
		<groupId>org.mybatis</groupId>
		<artifactId>mybatis</artifactId>
		<version>3.5.6</version>
	</dependency>
	<dependency>
		<groupId>mysql</groupId>
		<artifactId>mysql-connector-java</artifactId>
		<version>5.1.47</version>
	</dependency>
	<!--1.导入mybatis与spring整合的jar包-->
	<dependency>
		<groupId>org.mybatis</groupId>
		<artifactId>mybatis-spring</artifactId>
		<version>1.3.0</version>
	</dependency>
	<!--导入spring操作数据库必选的包-->
	<dependency>
		<groupId>org.springframework</groupId>
		<artifactId>spring-jdbc</artifactId>
		<version>5.2.10.RELEASE</version>
	</dependency>
</dependencies>
```

### 步骤 2：创建 Spring 核心配置

创建 Spring 核心配置类，通常使用 `@Configuration`、`@ComponentScan` 和 `@PropertySource` 注解。

```java
@Configuration
@ComponentScan("com.itheima")
@PropertySource("jdbc.properties")
public class SpringConfig {
}
```

### **步骤 3：创建 MyBatis 配置类**

创建 MyBatis 专用配置类，使用 `@Configuration` 注解。

* 定义 `SqlSessionFactoryBean`，用于创建 `SqlSessionFactory`。需要设置数据源（`DataSource`）和类型别名包（`typeAliasesPackage`）。
* 定义 `MapperScannerConfigurer`，用于扫描 Mapper 接口，并将其注册为 Spring Bean。需要设置 Mapper 接口的基础包（`basePackage`）。

```java
// 定义mybatis专用的配置类
@Configuration
public class MyBatisConfig {
// 定义创建SqlSessionFactory对应的bean
	@Bean
	public SqlSessionFactoryBean sqlSessionFactory(DataSource dataSource){
		//SqlSessionFactoryBean是由mybatis-spring包提供的，专用于整合用的对象
		SqlSessionFactoryBean sfb = new SqlSessionFactoryBean();
		//设置数据源替代原始配置中的environments的配置
		sfb.setDataSource(dataSource);
		//设置类型别名替代原始配置中的typeAliases的配置
		sfb.setTypeAliasesPackage("com.itheima.domain");
		return sfb;
	}
// 定义加载所有的映射配置
	@Bean
	public MapperScannerConfigurer mapperScannerConfigurer(){
		MapperScannerConfigurer msc = new MapperScannerConfigurer();
		msc.setBasePackage("com.itheima.dao");
		return msc;
	}

}
```

### **步骤 4：数据源配置类**

创建数据源配置类，用于配置数据库连接信息。通常使用 `@Configuration` 注解，并通过 `@Value` 注解从 properties 文件中读取数据库连接信息。

```java
@Configuration
public class JdbcConfig {
	@Value("${jdbc.driver}")
	private String driver;
	@Value("${jdbc.url}")
	private String url;
	@Value("${jdbc.username}")
	private String userName;
	@Value("${jdbc.password}")
	private String password;

	@Bean("dataSource")
	public DataSource dataSource(){
		DruidDataSource ds = new DruidDataSource();
		ds.setDriverClassName(driver);
		ds.setUrl(url);
		ds.setUsername(userName);
		ds.setPassword(password);
		return ds;
	}
}
```

### **步骤 5：设置数据库连接信息**

在 `jdbc.properties` 文件中配置数据库连接信息，包括驱动类名、URL、用户名和密码。

```properties
jdbc.driver=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/spring_db?useSSL=false
jdbc.username=root
jdbc.password=root
```

## 2. Spring Boot 整合 MyBatis

相比之下，Spring Boot 整合 MyBatis 则简单得多。

### **步骤 1：添加依赖**

创建项目时勾选 `MyBatis` 和对应的数据库驱动，或者手动添加相应的 starter 依赖。

```xml
<dependencies>
	<!--1.导入对应的starter-->
	<dependency>
		<groupId>org.mybatis.spring.boot</groupId>
		<artifactId>mybatis-spring-boot-starter</artifactId>
		<version>2.2.0</version>
	</dependency>

	<dependency>
		<groupId>mysql</groupId>
		<artifactId>mysql-connector-java</artifactId>
		<scope>runtime</scope>
	</dependency>
</dependencies>
```

### **步骤 2：配置数据源**

在 `application.properties` 或 `application.yml` 文件中配置数据源相关信息，包括驱动类名、URL、用户名和密码。

```yaml
#2.配置相关信息
spring:
  datasource:
	driver-class-name: com.mysql.cj.jdbc.Driver
	url: jdbc:mysql://localhost:3306/ssm_db
	username: root
	password: root
```

## **3. 编写 MyBatis 代码**

编写实体类、Mapper 接口和测试类。

* 实体类：

	```java
	public class Book {
		private Integer id;
		private String type;
		private String name;
		private String description;
	}
	```

*   Mapper 接口：使用 `@Mapper` 注解将接口注册为 MyBatis 的 Mapper。

	```java
	@Mapper
	public interface BookDao {
		@Select("select * from tbl_book where id = #{id}")
		public Book getById(Integer id);
	}
	```

* 测试类：

	```java
	@SpringBootTest
	class Springboot05MybatisApplicationTests {
		@Autowired
		private BookDao bookDao;
		@Test
		void contextLoads() {
			System.out.println(bookDao.getById(1));
		}
	}
	```

注意事项：

*   **MySQL 8.x 时区问题**：在使用 MySQL 8.x 版本时，如果 Spring Boot 版本低于 2.4.3，可能会遇到时区问题。需要在数据库连接 URL 中添加 `serverTimezone` 参数来指定时区。

	```yaml
	# 配置相关信息
	spring:
	  datasource:
		driver-class-name: com.mysql.cj.jdbc.Driver
		url: jdbc:mysql://localhost:3306/ssm_db?serverTimezone=UTC
		username: root
		password: root
	```

    或者

    ```yaml
    # 配置相关信息
    spring:
      datasource:
        driver-class-name: com.mysql.cj.jdbc.Driver
        url: jdbc:mysql://localhost:3306/ssm_db?serverTimezone=Asia/Shanghai
        username: root
        password: root
    ```

    也可以修改 MySQL 配置文件 `mysql.ini`，在 `[mysqld]` 项中添加 `default-time-zone=+8:00`。

*   **数据库驱动过时警告**：如果出现数据库驱动过时的警告，将驱动类名更换为 `com.mysql.cj.jdbc.Driver`。

