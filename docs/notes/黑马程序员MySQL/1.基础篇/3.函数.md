---
title: 函数
createTime: 2025/07/28 16:25:35
permalink: /notes/HMMySQL/opbidhls/
---
函数是一段可以直接被另一段程序调用的程序或代码。 在 MySQL 中，函数已经预先定义好，开发者只需在合适的业务场景下调用相应的函数来完成需求。

**MySQL 中的函数主要分为以下四类：** 字符串函数、数值函数、日期函数和流程函数。 下面将分别介绍这些函数。

## 3.1 字符串函数

MySQL 中内置了许多字符串函数，以下是常用的字符串函数：

| 函数                 | 功能                                                              |
| :------------------- | :---------------------------------------------------------------- |
| `CONCAT(s1, s2, ...sn)` | 字符串拼接，将 `s1`，`s2`，... `sn` 拼接成一个字符串。                     |
| `LOWER(str)`         | 将字符串 `str` 全部转为小写。                                               |
| `UPPER(str)`         | 将字符串 `str` 全部转为大写。                                               |
| `LPAD(str, n, pad)`  | 左填充，用字符串 `pad` 对 `str` 的左边进行填充，达到 `n` 个字符的长度。            |
| `RPAD(str, n, pad)`  | 右填充，用字符串 `pad` 对 `str` 的右边进行填充，达到 `n` 个字符的长度。            |
| `TRIM(str)`          | 去掉字符串头部和尾部的空格。                                                    |
| `SUBSTRING(str, start, len)` | 返回从字符串 `str` 的 `start` 位置起的 `len` 个长度的字符串。                |

**示例：**

*   **字符串拼接：**
    ```sql
    select concat('Hello', ' MySQL');
    ```
*   **全部转小写：**
    ```sql
    select lower('Hello');
    ```
*   **全部转大写：**
    ```sql
    select upper('Hello');
    ```
*   **左填充：**
    ```sql
    select lpad('01', 5, '-');
    ```
*   **右填充：**
    ```sql
    select rpad('01', 5, '-');
    ```
*   **去除空格：**
    ```sql
    select trim(' Hello MySQL ');
    ```
*   **截取子字符串：**
    ```sql
    select substring('Hello MySQL', 1, 5);
    ```

::: example 案例

假设由于业务需求变更，企业员工的工号统一为 5 位数，不足 5 位的需要在前面补 0。例如，1 号员工的工号应该为 `00001`。

```sql
update emp set workno = lpad(workno, 5, '0');
```

上述代码使用 `LPAD` 函数对员工工号进行左填充，保证工号长度为 5 位。 其中，`emp` 表中包含员工信息，`workno` 字段存储员工的工号。

:::

## 3.2 数值函数

以下是常见的数值函数：

| 函数       | 功能                   |
| :--------- | :--------------------- |
| `CEIL(x)`  | 向上取整               |
| `FLOOR(x)` | 向下取整               |
| `MOD(x, y)` | 返回 `x / y` 的模      |
| `RAND()`   | 返回 0~1 内的随机数     |
| `ROUND(x, y)` | 求参数四舍五入的值，保留 `y` 位小数 |

**示例：**

*   **向上取整：**
    ```sql
    select ceil(1.1);
    ```
*   **向下取整：**
    ```sql
    select floor(1.9);
    ```
*   **取模：**
    ```sql
    select mod(7, 4);
    ```
*   **获取随机数：**
    ```sql
    select rand();
    ```
*   **四舍五入：**
    ```sql
    select round(2.344, 2);
    ```

::: example 案例

通过数据库的函数生成一个六位数的随机验证码。

**思路：** 获取随机数可以通过 `RAND()` 函数，但是获取出来的随机数在 0-1 之间，所以可以在其基础上乘以 1000000，然后舍弃小数部分，如果长度不足 6 位，补 0。

```sql
select lpad(round(rand() * 1000000, 0), 6, '0');
```

上述代码中，`RAND()` 函数生成一个 0 到 1 之间的随机数，乘以 1000000 后得到一个较大的随机数。 `ROUND(x, 0)` 函数用于四舍五入，保留整数部分。 最后，`LPAD()` 函数在左侧填充 0，保证验证码的长度为 6 位。

:::

## 3.3 日期函数

以下是常见的日期函数：

| 函数                   | 功能                     |
| :--------------------- | :----------------------- |
| `CURDATE()`            | 返回当前日期             |
| `CURTIME()`            | 返回当前时间             |
| `NOW()`                | 返回当前日期和时间       |
| `YEAR(date)`           | 获取指定 `date` 的年份   |
| `MONTH(date)`          | 获取指定 `date` 的月份   |
| `DAY(date)`            | 获取指定 `date` 的日期   |
| `DATE_ADD(date, INTERVAL expr type)` | 返回一个日期/时间值加上一个时间间隔 `expr` 后的时间值 |
| `DATEDIFF(date1, date2)` | 返回起始时间 `date1` 和结束时间 `date2` 之间的天数   |

**示例：**

*   **当前日期：**
    ```sql
    select curdate();
    ```
*   **当前时间：**
    ```sql
    select curtime();
    ```
*   **当前日期和时间：**
    ```sql
    select now();
    ```
*   **当前年、月、日：**
    ```sql
    select YEAR(now());
    select MONTH(now());
    select DAY(now());
    ```
*   **增加指定的时间间隔：**
    ```sql
    select date_add(now(), INTERVAL 70 YEAR);
    ```
*   **获取两个日期相差的天数：**
    ```sql
    select datediff('2021-10-01', '2021-12-01');
    ```

::: example 案例

查询所有员工的入职天数，并根据入职天数倒序排序。

**思路：** 入职天数就是通过当前日期 - 入职日期，所以需要使用 `DATEDIFF()` 函数来完成。

```sql
select name, datediff(curdate(), entrydate) as 'entrydays' from emp order by entrydays desc;
```

上述代码中，`DATEDIFF(curdate(), entrydate)` 计算了当前日期和入职日期之间的天数差，并将结果命名为 `entrydays`。 `ORDER BY entrydays DESC` 则按照入职天数降序排列。

:::

## 3.4 流程函数

流程函数也是很常用的一类函数，可以在 SQL 语句中实现条件筛选，从而提高语句的效率。

| 函数                      | 功能                                                                  |
| :------------------------ | :-------------------------------------------------------------------- |
| `IF(value, t, f)`         | 如果 `value` 为 `TRUE`，则返回 `t`，否则返回 `f`。                        |
| `IFNULL(value1, value2)`  | 如果 `value1` 不为空，返回 `value1`，否则返回 `value2`。                   |
| `CASE WHEN (val1) THEN (res1) ELSE (default) END` | 如果 `val1` 为 `TRUE`，返回 `res1`，... 否则返回 `default` 默认值。 |
| `CASE (expr) WHEN (val1) THEN (res1) ELSE (default) END`    | 如果 `expr` 的值等于 `val1`，返回 `res1`，... 否则返回 `default` 默认值。 |

**示例：**

*   **IF 函数：**
    ```sql
    select if(false, 'Ok', 'Error');
    ```
*   **IFNULL 函数：**
    ```sql
    select ifnull('Ok', 'Default');
    select ifnull('', 'Default');
    select ifnull(null, 'Default');
    ```
*   **CASE WHEN THEN ELSE END 结构：**
    ```sql
    select
        name,
        (
            case
                workaddress
                when '北京' then '一线城市'
                when '上海' then '一线城市'
                else '二线城市'
            end
        ) as '工作地址'
    from
        emp;
    ```

::: example 案例

根据成绩判断等级，并展示每个科目的等级。

```sql
select
    id,
    name,
    (
        case
            when math >= 85 then '优秀'
            when math >= 60 then '及格'
            else '不及格'
        end
    ) '数学',
    (
        case
            when english >= 85 then '优秀'
            when english >= 60 then '及格'
            else '不及格'
        end
    ) '英语',
    (
        case
            when chinese >= 85 then '优秀'
            when chinese >= 60 then '及格'
            else '不及格'
        end
    ) '语文'
from
    score;
```

上述代码使用 `CASE WHEN` 结构分别判断 `math`、`english` 和 `chinese` 成绩的等级，并返回对应的等级。

:::
