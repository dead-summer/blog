## 7.1 系统数据库

MySQL 数据库安装完成后，系统会自带以下四个数据库，它们的作用如下：

| 数据库             | 含义                                                                                                                                   |
| :----------------- | :------------------------------------------------------------------------------------------------------------------------------------- |
| `mysql`            | 存储 MySQL 服务器正常运行所需要的各种信息，例如时区、主从配置、用户及其权限等。                                                                               |
| `information_schema` | 提供了访问数据库元数据的各种表和视图，包含数据库、表、字段类型以及访问权限等信息。                                                                                      |
| `performance_schema` | 为 MySQL 服务器运行时状态提供了一个底层的监控功能，主要用于收集数据库服务器的性能参数。                                                                                   |
| `sys`              | 包含了一系列方便 DBA 和开发人员利用 `performance_schema` 性能数据库进行性能调优和诊断的视图。                                                                           |

## 7.2 常用工具

### 7.2.1 mysql

这里的 `mysql` 不是指 MySQL 服务本身，而是指 MySQL 的客户端工具。

```shell
mysql [options] [database]
```

常用选项包括：

*   `-u, --user=name`: 指定用户名。
*   `-p, --password[=name]`: 指定密码。
*   `-h, --host=name`: 指定服务器 IP 或域名。
*   `-P, --port=port`: 指定连接端口。
*   `-e, --execute=name`: 执行 SQL 语句并退出。

`-e` 选项允许在不连接到 MySQL 数据库的情况下执行 SQL 语句，这在批处理脚本中非常有用。例如：

```shell
mysql -uroot -p123456 db01 -e "select * from stu";
```

这条命令会以 `root` 用户身份连接到 `db01` 数据库，并执行 `select * from stu` 这条 SQL 查询语句，然后直接将结果输出到终端。

### 7.2.2 mysqladmin

`mysqladmin` 是一个用于执行管理操作的客户端程序。可以用它来检查服务器的配置和当前状态，创建和删除数据库等。

可以通过 `mysqladmin --help` 命令查看所有可用的选项。

常用选项包括：

*   `-u, --user=name`: 指定用户名。
*   `-p, --password[=name]`: 指定密码。
*   `-h, --host=name`: 指定服务器 IP 或域名。
*   `-P, --port=port`: 指定连接端口。

例如，以下命令用于删除名为 `test01` 的数据库：

```shell
mysqladmin -uroot -p1234 drop 'test01';
```

以下命令用于获取 MySQL 服务器的版本信息：

```shell
mysqladmin -uroot -p1234 version;
```

### 7.2.3 mysqlbinlog

由于服务器生成的二进制日志文件以二进制格式保存，如果想要以文本格式查看这些日志文件的内容，可以使用 `mysqlbinlog` 工具。

```shell
mysqlbinlog [options] log-files1 log-files2
```

常用选项包括：

*   `-d, --database-name`: 指定数据库名称，只列出指定的数据库相关操作。
*   `-o, --offset=#`: 忽略掉日志中的前 # 行命令。
*   `-r, --result-file=name`: 将输出的文本格式日志输出到指定文件。
*   `-s, --short-form`: 显示简单格式，省略掉一些信息。
*   `--start-datatime=date1 --stop-datetime=date2`: 指定日期间隔内的所有日志。
*   `--start-position=pos1 --stop-position=pos2`: 指定位置间隔内的所有日志。

可以使用 `mysqlbinlog binlog.000008` 查看 `binlog.000008` 这个二进制文件中的数据信息。

为了方便查询，可以加上 `-s` 参数来显示简单格式，例如：`mysqlbinlog -s binlog.000008`。

### 7.2.4 mysqlshow

`mysqlshow` 客户端对象查找工具，用于快速查找存在哪些数据库、数据库中的表、表中的列或者索引。

```shell
mysqlshow [options] [db_name [table_name [col_name]]]
```

常用选项：

*   `--count`: 显示数据库及表的统计信息（数据库、表均可以不指定）。
*   `-i`: 显示指定数据库或者指定表的状态信息。

例如：

```shell
mysqlshow -uroot -p2143 test --count
```

该命令用于查询 `test` 库中每个表的字段数以及行数。

```shell
mysqlshow -uroot -p2143 test book --count
```

该命令用于查询 `test` 库中 `book` 表的详细情况。

此外，课件中还展示了如何使用 `mysqlshow` 命令查询每个数据库的表的数量及表中记录的数量，查看数据库 `db01` 的统计信息，查看数据库 `db01` 中 `course` 表的信息，以及查看数据库 `db01` 中 `course` 表的 `id` 字段的信息。

### 7.2.5 mysqldump

`mysqldump` 客户端工具用于备份数据库或在不同数据库之间进行数据迁移。备份内容包含创建表以及插入表的 SQL 语句。

```shell
mysqldump [options] db_name [tables]
mysqldump [options] --database/-B db1 [db2 db3...]
mysqldump [options] --all-databases/-A
```

常用选项：

*   `-u, --user=name`: 指定用户名。
*   `-p, --password[=name]`: 指定密码。
*   `-h, --host=name`: 指定服务器 IP 或域名。
*   `-P, --port=#`: 指定连接端口。
*   `--add-drop-database`: 在每个数据库创建语句前加上 `drop database` 语句。
*   `--add-drop-table`: 在每个表创建语句前加上 `drop table` 语句，默认开启；不开启 (--skip-add-drop-table)。
*   `-n, --no-create-db`: 不包含数据库的创建语句。
*   `-t, --no-create-info`: 不包含数据表的创建语句。
*   `-d --no-data`: 不包含数据。
*   `-T, --tab=name`: 自动生成两个文件：一个 `.sql` 文件，包含创建表结构的语句；一个 `.txt` 文件，包含数据文件。

例如，备份 `db01` 数据库的命令如下：

```shell
mysqldump -uroot -p1234 db01 > db01.sql
```

执行完毕后，会生成一个名为 `db01.sql` 的文件，其中包含了 `db01` 数据库的备份数据。

备份出来的数据包含：

* 删除表的语句。
* 创建表的语句。
* 数据插入语句。

可以使用 `-t` 参数来备份数据库中的表数据，而不备份表结构。例如：

```shell
mysqldump -uroot -p1234 -t db01 > db01.sql
```

可以使用 `-T` 参数将数据库的表的表结构与数据分开备份。例如：

```shell
mysqldump -uroot -p1234 -T /root db01 score
```

::: note 

执行上述命令可能会出错，因为 MySQL 默认只允许将数据导出到特定的安全目录。可以通过查看 `secure_file_priv` 变量来确定允许的目录。

:::

如果导出的目录不被信任，需要将导出的目录修改为 `secure_file_priv` 指定的目录。

```shell
show variables like '%secure_file_priv%';
```

查询到目录后，修改命令为：

```shell
mysqldump -uroot -p1234 -T /var/lib/mysql-files/db01 score
```

执行该命令后，会在 `/var/lib/mysql-files/` 目录下生成 `score.sql` 和 `score.txt` 两个文件，分别存储了 `score` 表的结构和数据。

### 7.2.6 mysqlimport/source

1.  `mysqlimport`

	`mysqlimport` 是客户端数据导入工具，用于导入 `mysqldump` 加 `-T` 参数后导出的文本文件。

	```
	mysqlimport [options] db_name textfile1 [textfile2...]
	```

	例如：

	```
	mysqlimport -uroot -p2143 test /tmp/city.txt
	```

2.  `source`

	如果需要导入 SQL 文件，可以使用  中的 source 指令：

	```
	source /root/xxxxx.sql
	```

